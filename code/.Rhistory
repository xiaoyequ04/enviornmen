geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
theme_bw(base_size = 4) +
xlab("相关系数") +
ylab("") +
ggtitle("地方政府评价对垃圾分类的影响") +
theme_set(theme_gray(base_family = "STKaiti")) +
labs(caption = "来源：2021年中国社会综合调查。") +
theme(legend.position = "none") +
scale_colour_grey(
start = .3,
end = .7)
fig1
fig1 <- dwplot(glm_direct_parti[1]) %>%
relabel_predictors(c(
eva_central_z = "对中央政府的评价",
media = "媒体使用",
age = "年龄",
female = "性别",
party = "党派",
edu = "受教育程度",
socailLevel_now = "社会经济地位",
imcomePer_level = "个人收入",
race = "民族",
rural = "城镇户口",
health = "健康状况",
marriage = "婚姻状况")) +
geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
theme_bw(base_size = 4) +
xlab("相关系数") +
ylab("") +
ggtitle("中央政府评价对垃圾分类的影响") +
theme_set(theme_gray(base_family = "STKaiti")) +
labs(caption = "来源：2021年中国社会综合调查。") +
theme(legend.position = "none") +
scale_colour_grey(
start = .3,
end = .7)
fig1
fig1 <- dwplot(glm_direct_parti) %>%
relabel_predictors(c(
eva_central_z = "对中央政府的评价",
media = "媒体使用",
age = "年龄",
female = "性别",
party = "党派",
edu = "受教育程度",
socailLevel_now = "社会经济地位",
imcomePer_level = "个人收入",
race = "民族",
rural = "城镇户口",
health = "健康状况",
marriage = "婚姻状况")) +
geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
theme_bw(base_size = 4) +
xlab("相关系数") +
ylab("") +
ggtitle("中央政府评价对垃圾分类的影响") +
theme_set(theme_gray(base_family = "STKaiti")) +
labs(caption = "来源：2021年中国社会综合调查。") +
theme(legend.position = "none") +
scale_colour_grey(
start = .3,
end = .7)
fig1
fig1 <- dwplot(glm_direct_parti) %>%
relabel_predictors(c(
eva_central_z = "对中央政府的评价",
eva_local_z = "对地方政府的评价",
media = "媒体使用",
age = "年龄",
female = "性别",
party = "党派",
edu = "受教育程度",
socailLevel_now = "社会经济地位",
imcomePer_level = "个人收入",
race = "民族",
rural = "城镇户口",
health = "健康状况",
marriage = "婚姻状况")) +
geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
theme_bw(base_size = 4) +
xlab("相关系数") +
ylab("") +
ggtitle("中央政府评价对垃圾分类的影响") +
theme_set(theme_gray(base_family = "STKaiti")) +
labs(caption = "来源：2021年中国社会综合调查。") +
theme(legend.position = "none") +
scale_colour_grey(
start = .3,
end = .7)
fig1
#| label: medEffect
lm_med <- paste(ls_cv,collapse = " + ") %>%
paste0(ls_cv,"~ eva_central_z + ",.)
lm_med
#| label: medEffect
lm_med <- paste(ls_cv,collapse = " + ") %>%
paste0(ls_med,"~ eva_central_z + ",.)
lm_med
lm_cen2med <- map(lm_med_cen,~ lm(.,data = cgss2021))
#| label: medEffect
lm_med_cen <- paste(ls_cv,collapse = " + ") %>%
paste0(ls_med,"~ eva_central_z + ",.)
lm_cen2med <- map(lm_med_cen,~ lm(.,data = cgss2021))
lm_cen2med
names(lm_cen2med) <- c("环境效能感","环境关注度","责任归因","环境感知度")
modelsummary(lm_cen2med,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
cm
#| label: local2med
lm_med_local <- paste(ls_cv,collapse = " + ") %>%
paste0(ls_med,"~ eva_local_z + ",.)
lm_med_local
#| label: local2med
lm_med_local <- paste(ls_cv,collapse = " + ") %>%
paste0(ls_med," ~ eva_local_z + ",.)
lm_med_local
lm_local2med <- map(lm_med_local,~ lm(.,data = cgss2021))
names(lm_local2med) <-  c("环境效能感","环境关注度","责任归因","环境感知度")
modelsummary(lm_local2med,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
#| label: cen2parti
glm_cen_total <- paste(ls_cv,collapse = " + ") %>%
paste0("participate","~ eva_central_z + ",ls_med, " + ",.)
glm_cen_total
#| label: cen2parti
glm_cen_total <- paste(ls_cv,collapse = " + ") %>%
paste0("participate"," ~ eva_central_z + ","efficacyIn_std + ", "enCare_std + ","res_classr_std + ","pollut_perse_std + ",.)
glm_cen_total
glm_cen2parti_total <- glm(glm_cen_total,family = binomial,data = cgss2021)
modelsummary("总效应" = glm_cen2parti_total,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
names(glm_cen2parti_total) <- c("总效应")
modelsummary(glm_cen2parti_total,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
class(glm_cen2parti_total)
glm_cen2parti_total <- map(glm_cen_total,~ glm(.,family = binomial,data = cgss2021))
names(glm_cen2parti_total) <- c("总效应")
modelsummary(glm_cen2parti_total,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
#| label: regression
cm <-c(
eva_local_z = "对地方政府的评价",
eva_central_z = "对中央政府的评价",
efficacyIn = "内部环境效能感",
efficacyEx = "外部环境效能感",
res_classr = "责任归因",
pollut_perse = "环境感知度",
enCare = "环境关注度",
efficacyIn_std = "内部环境效能感(标准化)",
res_classr_std = "责任归因(标准化)",
pollut_perse_std = "环境感知度(标准化)",
enCare_std = "环境关注度(标准化)",
age = "年龄",
female = "性别",
party = "党派",
edu = "受教育程度",
socailLevel_now = "社会经济地位",
imcomePer_level = "个人收入",
race = "民族",
rural = "城镇户口",
health = "健康状况",
marriage = "婚姻状况",
media = "媒介使用",
trustSystem_z = "系统信任"
)
modelsummary(glm_cen2parti_total,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
cm
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total,
model.m = .x,
treat = "eva_central_z",
mediator = .y,
boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total,
model.m = .x,
treat = "eva_central_z",
mediator = .y,
boot = TRUE,
sims = 1000,
#robustSE = TRUE,
dropobs = TRUE
)
)
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE,
dpi = 600
)
if (!require(pacman))
install.packages("pacman")
library(pacman)
p_load(
dotwhisker,
drhutools,
grid,
gridExtra,
DiagrammeR,
DiagrammeRsvg,
rsvg,
# Visualization
mediation,
# Applied
knitr,
# dependency
broomExtra,
glue,
modelsummary,
tidyverse,
qs,
modelsummary
) # data wrangling # data wrangling
# Make sure htmlwidge (grViz) presented correctly
# Run once
# install.packages('webshot')
# webshot::install_phantomjs()
# Functions preload
theme_set(theme_minimal())
set.seed(313)
# Data input
## Run `dataProcessing.R` to create the data
cgss2010 <- readRDS("../data/cgss2010.rds") %>%
mutate(
internet_std = arm::rescale(internet),
freeSpeech_std = arm::rescale(freeSpeech),
socialLevel_std = arm::rescale(socialLevel),
EngDiffC_std = arm::rescale(EngDiffC)
)
ls_model_totalS <- paste(ls_ctrl, collapse = " + ") %>%
paste0("lm(", ls_ov, " ~ englishListen + englishSpeak + ",
paste(ls_med, collapse = " + "),
" + ",
.,
", data = cgss2010)")
ls_med <-
c("internet_std",
"freeSpeech_std",
"socialLevel_std",
"EngDiffC_std")
ls_ov <- c("efficacyIn", "efficacyEx")
ls_ctrl <-
c(
"edu",
"mandarin",
"age",
"female",
"incomeFamL",
"party",
"rural",
"migrant",
"minority",
"prov"
)
# Total effect
ls_model_total <- paste(ls_ctrl, collapse = " + ") %>%
paste0("lm(", ls_ov, " ~ english + ",
paste(ls_med, collapse = " + "),
" + ",
.,
", data = cgss2010)")
ls_model_total
result_total <- map(ls_model_total, ~ eval(parse(text = .)))
result_total
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total,
model.m = .x,
treat = "eva_central_z",
mediator = .y,
#boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
ls_med <- c("efficacyIn_std",
"enCare_std",
"res_classr_std",
"pollut_perse_std")
ls_ov <- c("action","participate")
ls_cv <-
c(
"edu",
"media",
"age",
"female",
"socailLevel_now",
"imcomePer_level",
"party",
"rural",
"health",
"race"
)
glm_cen_total <- paste(ls_cv,collapse = " + ") %>%
paste0("participate"," ~ eva_central_z + ",
paste(ls_med,collapse = " + "),
.)
glm_cen_total
glm_cen2parti_total <- map(glm_cen_total,~ glm(.,family = binomial,data = cgss2021))
glm_cen_total <- paste(ls_cv,collapse = " + ") %>%
paste0("participate"," ~ eva_central_z + ",
paste(ls_med,collapse = " + ")," + ",
.)
glm_cen2parti_total <- map(glm_cen_total,~ glm(.,family = binomial,data = cgss2021))
glm_cen_total
modelsummary(glm_cen2parti_total,
stars = TRUE,
coef_omit = "(Intercept)",
coef_rename = cm)
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total,
model.m = .x,
treat = "eva_central_z",
mediator = .y,
#boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
lm_cen2med <- map(lm_med_cen,~ lm(.,data = cgss2021))
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total,
model.m = .x,
treat = "eva_central_z",
mediator = .y,
#boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total[[1]],
model.m = .x,
treat = "eva_central_z",
mediator = .y,
#boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
med_central_parti
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total[1],
model.m = .x,
treat = "eva_central_z",
mediator = .y,
#boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
glm_cen2parti_total[[1]]
glm_direct_parti[1]
glm_direct_parti[[1]]
fig1 <- dwplot(glm_direct_parti[[1]]) %>%
relabel_predictors(c(
eva_central_z = "对中央政府的评价",
# eva_local_z = "对地方政府的评价",
media = "媒体使用",
age = "年龄",
female = "性别",
party = "党派",
edu = "受教育程度",
socailLevel_now = "社会经济地位",
imcomePer_level = "个人收入",
race = "民族",
rural = "城镇户口",
health = "健康状况",
marriage = "婚姻状况")) +
geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
theme_bw(base_size = 4) +
xlab("相关系数") +
ylab("") +
ggtitle("中央政府评价对垃圾分类的影响") +
theme_set(theme_gray(base_family = "STKaiti")) +
labs(caption = "来源：2021年中国社会综合调查。") +
theme(legend.position = "none") +
scale_colour_grey(
start = .3,
end = .7)
fig1 <- dwplot(glm_direct_parti[[1]]) %>%
relabel_predictors(c(
eva_central_z = "对中央政府的评价",
# eva_local_z = "对地方政府的评价",
media = "媒体使用",
age = "年龄",
female = "性别",
party = "党派",
edu = "受教育程度",
socailLevel_now = "社会经济地位",
imcomePer_level = "个人收入",
race = "民族",
rural = "城镇户口",
health = "健康状况",
marriage = "婚姻状况")) +
geom_vline(xintercept = 0, colour = "grey60", linetype = 2) +
theme_bw(base_size = 4) +
xlab("相关系数") +
ylab("") +
ggtitle("中央政府评价对垃圾分类的影响") +
theme_set(theme_gray(base_family = "STKaiti")) +
labs(caption = "来源：2021年中国社会综合调查。") +
theme(legend.position = "none") +
scale_colour_grey(
start = .3,
end = .7)
fig1
#| label: mediation analysis
med_central_parti <- map2(
lm_cen2med,
ls_med,
~ mediation::mediate(
model.y = glm_cen2parti_total[[1]],
model.m = .x,
treat = "eva_central_z",
mediator = .y,
#boot = TRUE,
sims = 1000,
robustSE = TRUE,
dropobs = TRUE
)
)
df_resultMed <- map(med_central_parti, function(aGroup) {
map2_df(aGroup, ls_med, function(aResult, aMediator) {
tibble(
mediator = aMediator,
effect = "aceB",
estimate = aResult$d.avg,
p.value = aResult$d.avg.p,
conf.low = aResult$d.avg.ci[1],
conf.high = aResult$d.avg.ci[2],
prop = scales::percent(aResult$n.avg)
) %>%
bind_rows(
tibble(
mediator = aMediator,
effect = "ade",
estimate = aResult$z.avg,
p.value = aResult$z.avg.p,
conf.low = aResult$z.avg.ci[1],
conf.high = aResult$z.avg.ci[2],
prop = ""
)
) %>%
bind_rows(
tibble(
mediator = aMediator,
effect = "total",
estimate = aResult$tau.coef,
p.value = aResult$tau.p,
conf.low = aResult$tau.ci[1],
conf.high = aResult$tau.ci[2],
prop = ""
)
)
})
})
View(med_central_parti)
med_central_parti[[1]]
med_central_parti[[1]][["n.avg"]]
med_central_parti[[2]][["d.avg.p"]]
